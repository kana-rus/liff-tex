import type { NextPage } from 'next'
import Head from 'next/head'
import { ChangeEvent, useEffect, useState } from 'react'

import styles from '../styles/main.module.css'
import katex from 'katex'


const Home: NextPage = () => {
  const [katexFontSize, setKatexFontSize] = useState(1.6)

  const handleChange = (e: ChangeEvent<HTMLTextAreaElement>) => {
    const currentText = e.target.value
    const katexArea = document.getElementById("katex-area")!
    katex.render(String.raw`${currentText}`, katexArea!, {
      throwOnError: false,
      displayMode: true
    })

    const rate = katexArea.clientWidth / katexArea.scrollWidth
    const newKatexFontSize = katexFontSize * rate * rate
    setKatexFontSize(newKatexFontSize)
    document.documentElement.style.setProperty(
      '--katex-font-size', `${newKatexFontSize}em`
    )
  }

  return (
    <>
      <Head>
        <title>LIFF-TEX</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main className={styles.mainStyle}>
        <div className={styles.previewStyle} id="katex-area" />
        <textarea
          className={styles.inputStyle}
          onChange={(e) => handleChange(e)}
        />
      </main>
    </>
  )
}

export default Home
